global
    log /dev/log local0
    log /dev/log local1 notice
    user haproxy
    group haproxy
    daemon

defaults
    log global
    mode tcp
    option tcplog
    timeout connect 5s
    timeout client 30s
    timeout server 30s

frontend rdp
    mode tcp
    bind 192.168.1.11:3389
    tcp-request inspect-delay 2s
    tcp-request content accept if RDP_COOKIE # will accept connections if RDP cookies are present, enabling further ACL checks.

    acl userID_a19281 rdp_cookie(mstshash) -i user123
    use_backend backend_a19281 if userID_a19281

    acl userID_8721bc rdp_cookie(mstshash) -i user456
    use_backend backend_8721bc if userID_8721bc

    default_backend backend_default  # Optional default backend

backend backend_a19281
    mode tcp
    server Server 192.168.1.12:3389 check inter 5s rise 2 fall 3

backend backend_8721bc
    mode tcp
    server Server 192.168.1.13:3389 check inter 5s rise 2 fall 3

backend backend_default
    mode tcp
    server fallback_server 192.168.1.14:3389 check

